<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8" />
  <title>ãƒ’ãƒ¤ãƒªãƒãƒƒãƒˆæŠ•ç¨¿ãƒãƒƒãƒ—</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
  <style>
    body {
      background-color: #fdf6e3;
      font-family: sans-serif;
      font-size: 1.2em;
      margin: 10px;
      color: #333;
    }
    h2 {
      text-align: center;
      color: #5b432b;
    }
    #map {
      height: 400px;
      width: 100%;
      margin: 1em 0;
    }
    .button-row, .genre-row {
      display: flex;
      flex-wrap: wrap;
      gap: 10px;
      justify-content: center;
      margin-bottom: 1em;
    }
    .button-row button, .genre-row label {
      background-color: #e6d3a8;
      border: none;
      padding: 10px 16px;
      font-size: 1em;
      border-radius: 8px;
      cursor: pointer;
    }
    .genre-row input[type="radio"] {
      margin-right: 8px;
    }
    textarea, input[type="text"], select {
      width: 100%;
      padding: 10px;
      margin-bottom: 1em;
      font-size: 1em;
    }
    .submit-row {
      display: flex;
      gap: 10px;
      justify-content: center;
    }
    .submit-row button {
      font-size: 1em;
      padding: 12px;
      border: none;
      border-radius: 8px;
      width: 45%;
      cursor: pointer;
    }
    .send-button {
      background-color: #a8cfa4;
      color: white;
    }
    .clear-button {
      background-color: #e57373;
      color: white;
    }
  </style>
</head>
<body>
  <h2>ãƒ’ãƒ¤ãƒªãƒãƒƒãƒˆæŠ•ç¨¿ãƒãƒƒãƒ—</h2>

  <div class="button-row">
    <button onclick="jumpTo('æ—§è±Šå²¡å¸‚')">æ—§è±Šå²¡å¸‚</button>
    <button onclick="jumpTo('åŸå´')">åŸå´</button>
    <button onclick="jumpTo('ç«¹é‡')">ç«¹é‡</button>
    <button onclick="jumpTo('æ—¥é«˜')">æ—¥é«˜</button>
    <button onclick="jumpTo('å‡ºçŸ³')">å‡ºçŸ³</button>
    <button onclick="jumpTo('ä½†æ±')">ä½†æ±</button>
  </div>

  <input type="text" id="addressInput" placeholder="ä¾‹ï¼šè±Šå²¡å¸‚æ—¥é«˜ç”ºæ±ŸåŸ" />
  <button onclick="searchAddress()">æ¤œç´¢</button>

  <div class="genre-row">
    <label><input type="radio" name="perspective" value="è‡ªå‹•è»Šèµ°è¡Œæ™‚" checked />ğŸš— è‡ªå‹•è»Š</label>
    <label><input type="radio" name="perspective" value="æ­©è¡Œæ™‚" />ğŸš¶â€â™‚ï¸ æ­©è¡Œ</label>
    <label><input type="radio" name="perspective" value="è‡ªè»¢è»Šé‹è»¢æ™‚" />ğŸš´â€â™€ï¸ è‡ªè»¢è»Š</label>
  </div>

  <div id="map"></div>

  <!-- â–¼ è¿½åŠ ï¼šå±é™ºã‚’æ„Ÿã˜ãŸçŠ¶æ³ -->
  <label for="situationSelect">ã©ã†ã„ã†çŠ¶æ³ã§å±é™ºã‚’æ„Ÿã˜ã¾ã—ãŸã‹ï¼Ÿ</label><br>
  <select id="situationSelect">
    <option value="è‡ªå‹•è»Šé‹è»¢æ™‚">ğŸš— è‡ªå‹•è»Šé‹è»¢æ™‚</option>
    <option value="æ­©è¡Œæ™‚">ğŸš¶â€â™€ï¸ æ­©è¡Œæ™‚</option>
    <option value="è‡ªè»¢è»Šé‹è»¢æ™‚">ğŸš²ï¸ è‡ªè»¢è»Šé‹è»¢æ™‚</option>
  </select>

  <label>å±é™ºå†…å®¹ï¼ˆè¤‡æ•°é¸æŠï¼‰</label><br>
  <label><input type="checkbox" value="é“ãŒç‹­ã„ãƒ»ã™ã‚Œé•ã„ã«ãã„" />é“ãŒç‹­ã„ãƒ»ã™ã‚Œé•ã„ã«ãã„</label><br>
  <label><input type="checkbox" value="è¦‹é€šã—ãŒæ‚ªã„" />è¦‹é€šã—ãŒæ‚ªã„</label><br>
  <label><input type="checkbox" value="è»Šã®ã‚¹ãƒ”ãƒ¼ãƒ‰ãŒæ—©ã„" />è»Šã®ã‚¹ãƒ”ãƒ¼ãƒ‰ãŒæ—©ã„</label><br>
  <label><input type="checkbox" value="ä¿¡å·ãƒ»æ¨™è­˜ãŒã‚ã‹ã‚Šã¥ã‚‰ã„ï¼ãªã„" />ä¿¡å·ãƒ»æ¨™è­˜ãŒã‚ã‹ã‚Šã¥ã‚‰ã„ï¼ãªã„</label><br>
  <label><input type="checkbox" value="å­ã©ã‚‚ãƒ»é«˜é½¢è€…ãŒã‚ˆãé€šã‚‹" />å­ã©ã‚‚ãƒ»é«˜é½¢è€…ãŒã‚ˆãé€šã‚‹</label><br>
  <label><input type="checkbox" value="é§è»Šãƒ»åœè»Šã®è»ŠãŒå¤šã„" />é§è»Šãƒ»åœè»Šã®è»ŠãŒå¤šã„</label><br>

  <label>è£œè¶³ï¼ˆä»»æ„ï¼‰</label>
  <textarea id="comment" placeholder="ä¾‹ï¼šå¤œã¯è¡—ç¯ãŒå°‘ãªã„ã§ã™"></textarea>

  <div class="submit-row">
    <button class="send-button" onclick="submitPin()">é€ä¿¡ã—ã¦ãƒãƒƒãƒ—ã«è¿½åŠ </button>
    <button class="clear-button" onclick="clearPins()">ãƒ”ãƒ³ã‚’ã™ã¹ã¦æ¶ˆã™</button>
  </div>

  <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
  <script>
    const GAS_URL = "https://script.google.com/macros/s/AKfycbzM6n_bQj3luIpZj1e5BDQQEIIDEFBETwJpBge8od-s7C6gdqwbdARM-CWKvqp3mMTdnA/exec";
    const map = L.map('map').setView([35.544444, 134.826667], 15);
    L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
      attribution: 'Map data Â© OpenStreetMap contributors'
    }).addTo(map);

    let selectedLatLng = null;
    let markers = [];

    map.on('click', function(e) {
      selectedLatLng = e.latlng;
      L.popup().setLatLng(e.latlng).setContent("ã“ã“ã«æŠ•ç¨¿ã—ã¾ã™").openOn(map);
    });

    function submitPin() {
      if (!selectedLatLng) return alert("åœ°å›³ã‚’ã‚¿ãƒƒãƒ—ã—ã¦ãã ã•ã„");

      const situation = document.getElementById("situationSelect").value;
      const perspective = document.querySelector('input[name="perspective"]:checked').value;
      const dangers = Array.from(document.querySelectorAll('input[type="checkbox"]:checked')).map(cb => cb.value).join(', ');
      const comment = document.getElementById("comment").value;

      const payload = {
        lat: selectedLatLng.lat,
        lng: selectedLatLng.lng,
        situation,
        perspective,
        dangers,
        comment
      };

      fetch(GAS_URL, {
        method: "POST",
        body: JSON.stringify(payload)
      }).then(res => res.text()).then(text => {
        if (text.includes("OK")) {
          const marker = L.marker(selectedLatLng).addTo(map).bindPopup(
            `${situation}<br>${perspective}<br>${dangers}<br>${comment}`
          );
          markers.push(marker);
          alert("é€ä¿¡ã—ã¾ã—ãŸï¼");
        } else {
          alert("é€ä¿¡å¤±æ•—: " + text);
        }
      });
    }

    function clearPins() {
      markers.forEach(m => map.removeLayer(m));
      markers = [];
    }

    function jumpTo(area) {
      const areas = {
        'æ—§è±Šå²¡å¸‚': [35.544444, 134.826667],
        'åŸå´': [35.630833, 134.818611],
        'ç«¹é‡': [35.685833, 134.714722],
        'æ—¥é«˜': [35.503611, 134.824444],
        'å‡ºçŸ³': [35.423889, 134.873889],
        'ä½†æ±': [35.383056, 134.984722]
      };
      if (areas[area]) map.setView(areas[area], 15);
    }

    function searchAddress() {
      const address = document.getElementById("addressInput").value;
      if (!address) return;
      fetch(`https://nominatim.openstreetmap.org/search?format=json&q=${encodeURIComponent(address)}`)
        .then(res => res.json())
        .then(data => {
          if (data && data.length > 0) {
            const latlng = [parseFloat(data[0].lat), parseFloat(data[0].lon)];
            map.setView(latlng, 15);
          } else {
            alert("å ´æ‰€ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“ã§ã—ãŸ");
          }
        });
    }
  </script>
</body>
</html>
